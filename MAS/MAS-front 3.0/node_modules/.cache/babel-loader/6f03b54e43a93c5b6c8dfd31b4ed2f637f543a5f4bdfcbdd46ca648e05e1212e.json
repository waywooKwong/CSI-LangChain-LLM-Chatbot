{"ast":null,"code":"import _regeneratorRuntime from \"E:/CSI-LangChain-LLM-Chatbot/MAS/MAS-front 3.0/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"E:/CSI-LangChain-LLM-Chatbot/MAS/MAS-front 3.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport Message from '@/components/Message.vue';\nimport apiClient from '@/axios';\nexport default {\n  components: {\n    Message: Message\n  },\n  data: function data() {\n    return {\n      query: '',\n      // 用户输入的消息\n      response: '',\n      // 服务器响应\n      messages: [],\n      // 消息列表\n      isSending: false,\n      // 是否正在发送消息或上传文件\n      files: [] // 待上传的文件列表\n    };\n  },\n  methods: {\n    // 处理文件上传，防止默认上传行为\n    handleFileUpload: function handleFileUpload(file) {\n      this.files.push(file);\n      return false; // 阻止默认上传行为\n    },\n    // 删除指定索引的文件\n    removeFile: function removeFile(index) {\n      this.files.splice(index, 1);\n    },\n    // 发送用户输入的消息\n    sendQuery: function sendQuery() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(_this.query.trim() === '')) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              // 添加用户消息到消息列表\n              _this.messages.push({\n                text: _this.query,\n                sender: 'user'\n              });\n              _this.scrollToBottom();\n              _this.isSending = true;\n              _context.prev = 5;\n              _context.next = 8;\n              return apiClient.post('/ask', {\n                query: _this.query\n              });\n            case 8:\n              res = _context.sent;\n              // 添加服务器响应到消息列表\n              _this.messages.push({\n                text: res.data.response,\n                sender: 'bot'\n              });\n              _context.next = 16;\n              break;\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](5);\n              console.error(_context.t0);\n              _this.messages.push({\n                text: '请求失败，请稍后再试。',\n                sender: 'bot'\n              });\n            case 16:\n              _context.prev = 16;\n              // 清空输入框并重置发送状态\n              _this.query = '';\n              _this.isSending = false;\n              _this.scrollToBottom();\n              return _context.finish(16);\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[5, 12, 16, 21]]);\n      }))();\n    },\n    // 上传文件\n    uploadFiles: function uploadFiles() {\n      var _this2 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var formData, i;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(_this2.files.length === 0)) {\n                _context2.next = 3;\n                break;\n              }\n              alert('请选择要上传的文件');\n              return _context2.abrupt(\"return\");\n            case 3:\n              _this2.isSending = true;\n              formData = new FormData();\n              for (i = 0; i < _this2.files.length; i++) {\n                formData.append('file', _this2.files[i]);\n              }\n              _context2.prev = 6;\n              _context2.next = 9;\n              return apiClient.post('/upload', formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n            case 9:\n              // 上传成功消息\n              _this2.messages.push({\n                text: '文件上传成功',\n                sender: 'bot'\n              });\n              _this2.files = [];\n              _context2.next = 17;\n              break;\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](6);\n              console.error(_context2.t0);\n              _this2.messages.push({\n                text: \"\\u6587\\u4EF6\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u8BF7\\u7A0D\\u540E\\u518D\\u8BD5\\u3002\\u9519\\u8BEF\\u4FE1\\u606F: \".concat(_context2.t0.response ? _context2.t0.response.data : _context2.t0.message),\n                sender: 'bot'\n              });\n            case 17:\n              _context2.prev = 17;\n              _this2.isSending = false;\n              _this2.scrollToBottom();\n              return _context2.finish(17);\n            case 21:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[6, 13, 17, 21]]);\n      }))();\n    },\n    // 滚动到聊天窗口底部\n    scrollToBottom: function scrollToBottom() {\n      var _this3 = this;\n      this.$nextTick(function () {\n        var chatWindow = _this3.$refs.chatWindow;\n        chatWindow.scrollTop = chatWindow.scrollHeight;\n      });\n    },\n    // 路由跳转到 AgentMap\n    goToAgentMap: function goToAgentMap() {\n      this.$router.push({\n        name: 'AgentMap'\n      });\n    },\n    // 跳转到 GitHub 页面\n    goToGithub: function goToGithub() {\n      window.open('https://github.com/waywooKwong/CSI-LangChain-LLM-Chatbot', '_blank');\n    }\n  }\n};","map":{"version":3,"names":["Message","apiClient","components","data","query","response","messages","isSending","files","methods","handleFileUpload","file","push","removeFile","index","splice","sendQuery","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","wrap","_callee$","_context","prev","next","trim","abrupt","text","sender","scrollToBottom","post","sent","t0","console","error","finish","stop","uploadFiles","_this2","_callee2","formData","i","_callee2$","_context2","length","alert","FormData","append","headers","concat","message","_this3","$nextTick","chatWindow","$refs","scrollTop","scrollHeight","goToAgentMap","$router","name","goToGithub","window","open"],"sources":["src/views/ChatView.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-main\">\r\n    <!-- 侧边栏 -->\r\n    <div class=\"side-bar\">\r\n      <div class=\"toggle-bar\">\r\n        <!-- 图标，点击后跳转到AgentMap页面 -->\r\n        <div @click=\"goToAgentMap()\" class=\"icon go-to-agent\" data-tooltip=\"Go to AgentMap\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"main-content\">\r\n      <!-- 聊天窗口头部 -->\r\n      <div class=\"chat-header\">\r\n        <h2>智能对话客服</h2>\r\n        <!-- \"关于\"按钮，点击后跳转到GitHub -->\r\n        <el-button class=\"about-button\" type=\"text\" @click=\"goToGithub\">关于</el-button>\r\n      </div>\r\n\r\n      <!-- 聊天窗口 -->\r\n      <div class=\"chat-window\" ref=\"chatWindow\">\r\n        <!-- 遍历并渲染每条消息 -->\r\n        <Message\r\n          v-for=\"(message, index) in messages\"\r\n          :key=\"index\"\r\n          :text=\"message.text\"\r\n          :sender=\"message.sender\"\r\n        />\r\n      </div>\r\n\r\n      <!-- 底部区域，包括输入框、上传按钮和发送按钮 -->\r\n      <el-footer class=\"footer\">\r\n        <!-- 文件上传组件 -->\r\n        <el-upload\r\n          class=\"upload-demo\"\r\n          ref=\"upload\"\r\n          action=\"\"\r\n          :file-list=\"fileList\"\r\n          :show-file-list=\"false\"\r\n          :before-upload=\"handleFileUpload\"\r\n          :disabled=\"isSending\"\r\n          multiple\r\n        >\r\n          <!-- 自定义上传按钮 -->\r\n          <template v-slot:trigger>\r\n            <el-button :disabled=\"isSending\">\r\n              <i class=\"el-icon-paperclip\" t></i>\r\n            </el-button>\r\n          </template>\r\n        </el-upload>\r\n        <!-- 文件列表 -->\r\n        <ul class=\"file-list\">\r\n          <li v-for=\"(file, index) in files\" :key=\"index\">\r\n            {{ file.name }}\r\n            <el-button type=\"text\" @click=\"removeFile(index)\">删除</el-button>\r\n          </li>\r\n        </ul>\r\n        <!-- 消息输入框 -->\r\n        <el-input\r\n          v-model=\"query\"\r\n          placeholder=\"Type a message\"\r\n          @keyup.enter=\"sendQuery\"\r\n          :disabled=\"isSending\"\r\n        ></el-input>\r\n        <!-- 发送按钮 -->\r\n        <el-button\r\n          type=\"primary\"\r\n          @click=\"sendQuery\"\r\n          :disabled=\"isSending\"\r\n        >发送</el-button>\r\n        <!-- 上传文件按钮 -->\r\n        <el-button\r\n          type=\"success\"\r\n          @click=\"uploadFiles\"\r\n          :disabled=\"isSending || files.length === 0\"\r\n        >上传文件</el-button>\r\n      </el-footer>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Message from '@/components/Message.vue';\r\nimport apiClient from '@/axios';\r\n\r\nexport default {\r\n  components: {\r\n    Message,\r\n  },\r\n  data() {\r\n    return {\r\n      query: '', // 用户输入的消息\r\n      response: '', // 服务器响应\r\n      messages: [], // 消息列表\r\n      isSending: false, // 是否正在发送消息或上传文件\r\n      files: [], // 待上传的文件列表\r\n    };\r\n  },\r\n  methods: {\r\n    // 处理文件上传，防止默认上传行为\r\n    handleFileUpload(file) {\r\n      this.files.push(file);\r\n      return false; // 阻止默认上传行为\r\n    },\r\n    // 删除指定索引的文件\r\n    removeFile(index) {\r\n      this.files.splice(index, 1);\r\n    },\r\n    // 发送用户输入的消息\r\n    async sendQuery() {\r\n      if (this.query.trim() === '') return;\r\n\r\n      // 添加用户消息到消息列表\r\n      this.messages.push({ text: this.query, sender: 'user' });\r\n      this.scrollToBottom();\r\n\r\n      this.isSending = true;\r\n\r\n      try {\r\n        // 发送请求到服务器\r\n        const res = await apiClient.post('/ask', {\r\n          query: this.query,\r\n        });\r\n        // 添加服务器响应到消息列表\r\n        this.messages.push({ text: res.data.response, sender: 'bot' });\r\n      } catch (error) {\r\n        console.error(error);\r\n        this.messages.push({ text: '请求失败，请稍后再试。', sender: 'bot' });\r\n      } finally {\r\n        // 清空输入框并重置发送状态\r\n        this.query = '';\r\n        this.isSending = false;\r\n        this.scrollToBottom();\r\n      }\r\n    },\r\n    // 上传文件\r\n    async uploadFiles() {\r\n      if (this.files.length === 0) {\r\n        alert('请选择要上传的文件');\r\n        return;\r\n      }\r\n\r\n      this.isSending = true;\r\n\r\n      const formData = new FormData();\r\n      for (let i = 0; i < this.files.length; i++) {\r\n        formData.append('file', this.files[i]);\r\n      }\r\n\r\n      try {\r\n        // 发送文件上传请求\r\n        await apiClient.post('/upload', formData, {\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n          },\r\n        });\r\n        // 上传成功消息\r\n        this.messages.push({ text: '文件上传成功', sender: 'bot' });\r\n        this.files = [];\r\n      } catch (error) {\r\n        console.error(error);\r\n        this.messages.push({\r\n          text: `文件上传失败，请稍后再试。错误信息: ${\r\n            error.response ? error.response.data : error.message\r\n          }`,\r\n          sender: 'bot',\r\n        });\r\n      } finally {\r\n        this.isSending = false;\r\n        this.scrollToBottom();\r\n      }\r\n    },\r\n    // 滚动到聊天窗口底部\r\n    scrollToBottom() {\r\n      this.$nextTick(() => {\r\n        const chatWindow = this.$refs.chatWindow;\r\n        chatWindow.scrollTop = chatWindow.scrollHeight;\r\n      });\r\n    },\r\n    // 路由跳转到 AgentMap\r\n    goToAgentMap() {\r\n      this.$router.push({ name: 'AgentMap' });\r\n    },\r\n    // 跳转到 GitHub 页面\r\n    goToGithub() {\r\n      window.open('https://github.com/waywooKwong/CSI-LangChain-LLM-Chatbot', '_blank');\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/assets/fonts/index\";\r\n\r\n.chat-main {\r\n  display: flex;\r\n  height: 100%;\r\n}\r\n\r\n.main-content {\r\n  display: flex;\r\n  flex: 1;\r\n  flex-direction: column;\r\n}\r\n\r\n.chat-header {\r\n  height: 60px;\r\n  padding: 0 10px;\r\n  background-color: rgb(126,18,110);\r\n  border-bottom: 1px solid #f4f4f4;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  position: relative;\r\n  color: white;\r\n\r\n  h2 {\r\n    margin: 0;\r\n    flex: 1;\r\n    text-align: center;\r\n  }\r\n\r\n  .about-button {\r\n    position: absolute;\r\n    right: 10px;\r\n    top: 50%;\r\n    transform: translateY(-50%);\r\n    border-radius: 20%;\r\n    width: 20px; /* 设置按钮宽度 */\r\n    height: 40px; /* 设置按钮高度 */\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: #FFFFFF;\r\n    padding: 0;\r\n  }\r\n}\r\n\r\n.chat-window {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding: 10px;\r\n  border-bottom: 1px solid #dcdfe6;\r\n}\r\n\r\n.footer {\r\n  display: flex;\r\n  padding: 10px;\r\n  background-color: #fff;\r\n}\r\n\r\n.footer .el-input {\r\n  flex: 1;\r\n  margin-right: 10px;\r\n}\r\n\r\n.upload-demo {\r\n  margin-right: 10px;\r\n}\r\n\r\n.file-list {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0 10px 10px 0;\r\n}\r\n\r\n.file-list li {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background-color: #f9f9f9;\r\n  padding: 5px;\r\n  border-radius: 3px;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.side-bar {\r\n  height: 100%;\r\n  max-width: 250px;\r\n  z-index: 2;\r\n  background: none;\r\n  display: flex;\r\n\r\n  .toggle-bar {\r\n    height: 100%;\r\n    width: 50px;\r\n    background: #222222;\r\n    z-index: 2;\r\n    display: flex;\r\n    flex-flow: column;\r\n    align-items: center;\r\n    padding: 13px;\r\n\r\n    .icon {\r\n      margin-bottom: 26px;\r\n      font-size: 24px;\r\n      color: #FFFFFF;\r\n      cursor: pointer;\r\n      position: relative;\r\n\r\n      &:before {\r\n        @include icon;\r\n      }\r\n\r\n      /* Tooltip styling */\r\n      &::after {\r\n        content: attr(data-tooltip);\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 100%;\r\n        transform: translateY(-50%) translateX(10px); /* 右侧显示并略微偏移 */\r\n        background: #333;\r\n        color: #fff;\r\n        padding: 5px 10px;\r\n        border-radius: 4px;\r\n        white-space: nowrap;\r\n        font-size: 12px; /* 缩小字体 */\r\n        opacity: 0;\r\n        visibility: hidden;\r\n        transition: opacity 0.3s, visibility 0.3s;\r\n        z-index: 10;\r\n      }\r\n\r\n      &:hover::after {\r\n        opacity: 1;\r\n        visibility: visible;\r\n      }\r\n    }\r\n\r\n    .go-to-agent {\r\n      &:before {\r\n        content: '\\E8AF'; /* 请确保这个内容与您的字体图标设置相匹配 */\r\n      }\r\n    }\r\n\r\n    .disabled-icon {\r\n      opacity: 0.35;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"mappings":";;;;;AAiFA,OAAAA,OAAA;AACA,OAAAC,SAAA;AAEA;EACAC,UAAA;IACAF,OAAA,EAAAA;EACA;EACAG,IAAA,WAAAA,KAAA;IACA;MACAC,KAAA;MAAA;MACAC,QAAA;MAAA;MACAC,QAAA;MAAA;MACAC,SAAA;MAAA;MACAC,KAAA;IACA;EACA;EACAC,OAAA;IACA;IACAC,gBAAA,WAAAA,iBAAAC,IAAA;MACA,KAAAH,KAAA,CAAAI,IAAA,CAAAD,IAAA;MACA;IACA;IACA;IACAE,UAAA,WAAAA,WAAAC,KAAA;MACA,KAAAN,KAAA,CAAAO,MAAA,CAAAD,KAAA;IACA;IACA;IACAE,SAAA,WAAAA,UAAA;MAAA,IAAAC,KAAA;MAAA,OAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;QAAA,IAAAC,GAAA;QAAA,OAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAA,MACAV,KAAA,CAAAb,KAAA,CAAAwB,IAAA;gBAAAH,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAA,OAAAF,QAAA,CAAAI,MAAA;YAAA;cAEA;cACAZ,KAAA,CAAAX,QAAA,CAAAM,IAAA;gBAAAkB,IAAA,EAAAb,KAAA,CAAAb,KAAA;gBAAA2B,MAAA;cAAA;cACAd,KAAA,CAAAe,cAAA;cAEAf,KAAA,CAAAV,SAAA;cAAAkB,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAIA1B,SAAA,CAAAgC,IAAA;gBACA7B,KAAA,EAAAa,KAAA,CAAAb;cACA;YAAA;cAFAkB,GAAA,GAAAG,QAAA,CAAAS,IAAA;cAGA;cACAjB,KAAA,CAAAX,QAAA,CAAAM,IAAA;gBAAAkB,IAAA,EAAAR,GAAA,CAAAnB,IAAA,CAAAE,QAAA;gBAAA0B,MAAA;cAAA;cAAAN,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAU,EAAA,GAAAV,QAAA;cAEAW,OAAA,CAAAC,KAAA,CAAAZ,QAAA,CAAAU,EAAA;cACAlB,KAAA,CAAAX,QAAA,CAAAM,IAAA;gBAAAkB,IAAA;gBAAAC,MAAA;cAAA;YAAA;cAAAN,QAAA,CAAAC,IAAA;cAEA;cACAT,KAAA,CAAAb,KAAA;cACAa,KAAA,CAAAV,SAAA;cACAU,KAAA,CAAAe,cAAA;cAAA,OAAAP,QAAA,CAAAa,MAAA;YAAA;YAAA;cAAA,OAAAb,QAAA,CAAAc,IAAA;UAAA;QAAA,GAAAlB,OAAA;MAAA;IAEA;IACA;IACAmB,WAAA,WAAAA,YAAA;MAAA,IAAAC,MAAA;MAAA,OAAAvB,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAsB,SAAA;QAAA,IAAAC,QAAA,EAAAC,CAAA;QAAA,OAAAzB,mBAAA,GAAAI,IAAA,UAAAsB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAApB,IAAA,GAAAoB,SAAA,CAAAnB,IAAA;YAAA;cAAA,MACAc,MAAA,CAAAjC,KAAA,CAAAuC,MAAA;gBAAAD,SAAA,CAAAnB,IAAA;gBAAA;cAAA;cACAqB,KAAA;cAAA,OAAAF,SAAA,CAAAjB,MAAA;YAAA;cAIAY,MAAA,CAAAlC,SAAA;cAEAoC,QAAA,OAAAM,QAAA;cACA,KAAAL,CAAA,MAAAA,CAAA,GAAAH,MAAA,CAAAjC,KAAA,CAAAuC,MAAA,EAAAH,CAAA;gBACAD,QAAA,CAAAO,MAAA,SAAAT,MAAA,CAAAjC,KAAA,CAAAoC,CAAA;cACA;cAAAE,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAnB,IAAA;cAAA,OAIA1B,SAAA,CAAAgC,IAAA,YAAAU,QAAA;gBACAQ,OAAA;kBACA;gBACA;cACA;YAAA;cACA;cACAV,MAAA,CAAAnC,QAAA,CAAAM,IAAA;gBAAAkB,IAAA;gBAAAC,MAAA;cAAA;cACAU,MAAA,CAAAjC,KAAA;cAAAsC,SAAA,CAAAnB,IAAA;cAAA;YAAA;cAAAmB,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAX,EAAA,GAAAW,SAAA;cAEAV,OAAA,CAAAC,KAAA,CAAAS,SAAA,CAAAX,EAAA;cACAM,MAAA,CAAAnC,QAAA,CAAAM,IAAA;gBACAkB,IAAA,6GAAAsB,MAAA,CACAN,SAAA,CAAAX,EAAA,CAAA9B,QAAA,GAAAyC,SAAA,CAAAX,EAAA,CAAA9B,QAAA,CAAAF,IAAA,GAAA2C,SAAA,CAAAX,EAAA,CAAAkB,OAAA,CACA;gBACAtB,MAAA;cACA;YAAA;cAAAe,SAAA,CAAApB,IAAA;cAEAe,MAAA,CAAAlC,SAAA;cACAkC,MAAA,CAAAT,cAAA;cAAA,OAAAc,SAAA,CAAAR,MAAA;YAAA;YAAA;cAAA,OAAAQ,SAAA,CAAAP,IAAA;UAAA;QAAA,GAAAG,QAAA;MAAA;IAEA;IACA;IACAV,cAAA,WAAAA,eAAA;MAAA,IAAAsB,MAAA;MACA,KAAAC,SAAA;QACA,IAAAC,UAAA,GAAAF,MAAA,CAAAG,KAAA,CAAAD,UAAA;QACAA,UAAA,CAAAE,SAAA,GAAAF,UAAA,CAAAG,YAAA;MACA;IACA;IACA;IACAC,YAAA,WAAAA,aAAA;MACA,KAAAC,OAAA,CAAAjD,IAAA;QAAAkD,IAAA;MAAA;IACA;IACA;IACAC,UAAA,WAAAA,WAAA;MACAC,MAAA,CAAAC,IAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}